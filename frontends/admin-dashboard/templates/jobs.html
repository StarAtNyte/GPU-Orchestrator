{% extends "base.html" %}

{% block title %}Jobs - GPU Orchestrator Admin{% endblock %}

{% block content %}
<header>
    <p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Job Management</p>
</header>

<!-- Filters and Search -->
<section class="glassmorphism-card rounded-xl p-6">
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Status</label>
            <select id="filter-status" class="w-full px-4 py-2 bg-[#252249] border border-[#363168] rounded-lg text-white focus:ring-2 focus:ring-[#6366f1]">
                <option value="">All</option>
                <option value="PENDING">Pending</option>
                <option value="QUEUED">Queued</option>
                <option value="PROCESSING">Processing</option>
                <option value="COMPLETED">Completed</option>
                <option value="FAILED">Failed</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">App</label>
            <select id="filter-app" class="w-full px-4 py-2 bg-[#252249] border border-[#363168] rounded-lg text-white focus:ring-2 focus:ring-[#6366f1]">
                <option value="">All Apps</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Search Job ID</label>
            <input type="text" id="search-job-id" placeholder="Enter job ID..." class="w-full px-4 py-2 bg-[#252249] border border-[#363168] rounded-lg text-white placeholder-gray-500 focus:ring-2 focus:ring-[#6366f1]">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Per Page</label>
            <select id="filter-limit" class="w-full px-4 py-2 bg-[#252249] border border-[#363168] rounded-lg text-white focus:ring-2 focus:ring-[#6366f1]">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
            </select>
        </div>
        <div class="flex items-end">
            <button onclick="applyFilters()" class="w-full px-4 py-2 bg-gradient-to-r from-[#6366f1] to-[#8b5cf6] hover:opacity-90 rounded-lg text-white font-medium">
                Apply Filters
            </button>
        </div>
    </div>
</section>

<!-- Jobs Table -->
<section class="space-y-4">
    <div class="rounded-xl border border-[#363168] glassmorphism-card overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-300">
                <thead class="text-xs text-gray-400 uppercase bg-[#252249]/50">
                    <tr>
                        <th class="px-6 py-3">Job ID</th>
                        <th class="px-6 py-3">App</th>
                        <th class="px-6 py-3">Status</th>
                        <th class="px-6 py-3">Created</th>
                        <th class="px-6 py-3">Duration</th>
                        <th class="px-6 py-3">Worker</th>
                        <th class="px-6 py-3">Cost</th>
                        <th class="px-6 py-3">Actions</th>
                    </tr>
                </thead>
                <tbody id="jobs-tbody">
                    <tr>
                        <td colspan="8" class="px-6 py-8 text-center text-gray-400">
                            Loading jobs...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="flex justify-between items-center px-2">
        <p id="pagination-info" class="text-gray-400 text-sm">Showing 0 jobs</p>
        <div class="flex gap-2">
            <button id="btn-prev" onclick="previousPage()" class="px-4 py-2 bg-[#252249] border border-[#363168] rounded-lg text-white hover:bg-[#363168]" disabled>
                Previous
            </button>
            <button id="btn-next" onclick="nextPage()" class="px-4 py-2 bg-[#252249] border border-[#363168] rounded-lg text-white hover:bg-[#363168]" disabled>
                Next
            </button>
        </div>
    </div>
</section>

<!-- Job Detail Modal -->
<div id="job-detail-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
    <div class="glassmorphism-card rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 glassmorphism-card border-b border-[#363168] p-6 flex justify-between items-start">
            <div>
                <h2 class="text-2xl font-bold text-white mb-2">Job Details</h2>
                <p id="modal-job-id" class="text-gray-400 text-sm font-mono"></p>
            </div>
            <button onclick="closeJobModal()" class="material-symbols-outlined text-gray-400 hover:text-white text-3xl">
                close
            </button>
        </div>

        <div id="modal-job-content" class="p-6 space-y-6">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/jobs.js"></script>
{% endblock %}
